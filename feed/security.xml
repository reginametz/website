<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://scs.community/feed/security.xml" rel="self" type="application/atom+xml" /><link href="https://scs.community/" rel="alternate" type="text/html" hreflang="en" /><updated>2024-03-21T11:52:40+00:00</updated><id>https://scs.community/feed/security.xml</id><title type="html">Sovereign Cloud Stack | Security</title><subtitle>Sovereign Cloud Stack combines the best of cloud computing in one unified standard. SCS is built, backed, and operated by an active open-source community worldwide. Together we put users in control of their data by enabling cloud operators through a decentralized and federated cloud stack – leveraging true digital sovereignty to foster trust in clouds.</subtitle><entry><title type="html">Sovereign Cloud Stack Security Advisory OVN (CVE-2024-2182)</title><link href="https://scs.community/security/2024/03/15/cve-2024-2182/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory OVN (CVE-2024-2182)" /><published>2024-03-15T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2024/03/15/cve-2024-2182</id><content type="html" xml:base="https://scs.community/security/2024/03/15/cve-2024-2182/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>Multiple versions of OVN (Open Virtual Network) are vulnerable to
crafted BFD packets potentially causing denial of service.</p>

<p>OVN supports configuration of gateway chassis and high-availability
chassis groups (via the Gateway_Chassis and HA_Chassis_Group tables in
the OVN_Northbound database).  These group cluster nodes (chassis)
together and provide high availability to them.  OVN logical switch and
router ports can be configured to reference such groups.  In this case
the traffic forwarding decision is influenced by the liveness of the
chassis listed in the group.</p>

<p>In such scenarios OVN automatically enables the OVS Bidirectional
Forwarding Detection (BFD) functionality to monitor the health of remote
nodes and tunnels between them.</p>

<p>BFD packets are transmitted in-band in tunnels that connect OVN chassis,
along with other traffic.  And, by default, OVS will process any BFD
packets received on a tunnel port with BFD enabled.  That makes it
possible for a VM or container connected to an OVN logical switch port
to send BFD packets that will be tunneled to another node and processed
by OVS, potentially changing the BFD state and affecting the forwarding
decisions.</p>

<p>The vulnerability has been assigned <a href="https://www.cve.org/CVERecord?id=CVE-2024-2182">CVE-2024-2182</a>.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>The <a href="https://scs.community/">Sovereign Cloud Stack</a> reference
implementation (by <a href="https://osism.tech/">OSISM</a>) comes with and utilizes 
OVN. The upcoming Release 6 of the SCS reference implementation will
not be vulnerable to this as Release 6 will contain the OVN <a href="https://www.ovn.org/en/releases/changelog_v24.03.1/">version 24.03.1</a>.</p>

<p>A way to determine if BFD will be used is to issue the following
commands on the node that runs the OVN central components:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker exec -it ovn_nb_db ovn-nbctl --columns name,gateway_chassis list logical_router_port
</code></pre></div></div>

<p>If the above command returns more than a single gateway chassis
reference for a given port that means OVS BFD has been automatically
enabled.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker exec -it ovn_nb_db ovn-nbctl --columns name,ha_chassis list ha_chassis_group
</code></pre></div></div>

<p>The same applies if the above command returns groups that contain more
than one chassis.</p>

<p>In any case, operators of OpenStack platforms are advised to deploy fixed versions.</p>

<h2 id="mitigation-and-fixes">Mitigation and Fixes</h2>

<p>For any version of OVN, in order to prevent the issue, an ACL (Access
Control List) rule can be added to drop BFD packets originated from
logical ports.</p>

<p>For example, the following shell script would configure ACLs on all
existing OVN logical switches:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  for sw in $(docker exec -it ovn_nb_db ovn-nbctl --bare --columns name list logical_switch); do
      docker exec -it ovn_nb_db ovn-nbctl acl-add $sw from-lport 32767 'udp &amp;&amp; udp.dst == 3784' drop
  done
</code></pre></div></div>

<p>We do not recommend attempting to mitigate the vulnerability this way
because this will also drop legitimate BFD traffic originated by the
workloads connected to logical switch ports, e.g., BFD sessions
established with external entities.</p>

<p>For the currently maintained version SCS R5 (OSISM 6.0.x), OVN has been updated to <a href="https://www.ovn.org/en/releases/changelog_v23.06.3/">23.06.3</a>.
Updated images have been built by <a href="https://osism.tech/">OSISM</a> and are available to be installed.</p>

<p>To install the fixed OVN images, set <code class="language-plaintext highlighter-rouge">ovn_tag: "2023.1"</code> in the configuration repository in <code class="language-plaintext highlighter-rouge">environments/kolla/configuration.yml</code>.
Afterwards run <code class="language-plaintext highlighter-rouge">osism apply -a upgrade ovn</code>.</p>

<p>This will deploy the latest OVN images for OSISM 6.0.x series (SCS R5, using OpenStack 2023.1 (Antelope)), pulling OVN 23.06.3.
This only replaces the OVN image and no service interruption is to be expected.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial Draft, v0.1, 2024-03-14, 23:45 CET.</li>
</ul>]]></content><author><name>[&quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/default-card.jpg" /><media:content medium="image" url="https://scs.community/default-card.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory Open vSwitch (CVE-2023-3966)</title><link href="https://scs.community/security/2024/02/20/cve-2023-3966/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory Open vSwitch (CVE-2023-3966)" /><published>2024-02-20T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2024/02/20/cve-2023-3966</id><content type="html" xml:base="https://scs.community/security/2024/02/20/cve-2023-3966/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>Multiple versions of Open vSwitch are vulnerable to crafted Geneve
packets causing invalid memory accesses and potential denial of service.
Triggering the vulnerability requires that Open vSwitch has flow hardware
offload with Linux TC flower enabled (other_config:hw-offload=true).
It is not enabled by default.</p>

<p>The issue is caused by insufficient validation of Geneve metadata
fields in the offload path.  Open vSwitch versions 2.12 and newer are
affected.</p>

<p>The vulnerability has been assigned <a href="https://www.cve.org/CVERecord?id=CVE-2023-3966">CVE-2023-3966</a>.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>The <a href="https://scs.community/">Sovereign Cloud Stack</a> reference
implementation (by <a href="https://osism.tech/">OSISM</a>) comes with and utilizes 
Open vSwitch. While hardware offloading is not enabled by default most
environments will have it enabled.</p>

<p>The current state of configuration can be checked with this command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dragon@manager:~$ docker exec -it openvswitch_vswitchd ovs-vsctl get Open_vSwitch . other_config:hw-offload
ovs-vsctl: no key "hw-offload" in Open_vSwitch record "." column other_config
</code></pre></div></div>

<p>If hardware offloading is enabled the output differs:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dragon@manager:~$ docker exec -it openvswitch_vswitchd ovs-vsctl get Open_vSwitch . other_config:hw-offload
"true"
</code></pre></div></div>

<p>This is typically enabled through <code class="language-plaintext highlighter-rouge">openvswitch_hw_offload: "yes"</code> in the host vars or <code class="language-plaintext highlighter-rouge">configuration.yml</code>.</p>

<p>In any case, operators of OpenStack platforms are advised to deploy fixed versions.</p>

<h2 id="mitigation-and-fixes">Mitigation and Fixes</h2>

<p>For any version of Open vSwitch, disabling flow hardware offload will
prevent the issue (setting other_config:hw-offload=false and reboot
the system).  We do not recommend attempting to mitigate the vulnerability
this way because it may impact the overall system throughput.</p>

<p>By default, flow hardware offload support is not enabled.</p>

<p>Open vSwitch has been updated to <a href="https://www.openvswitch.org/releases/NEWS-3.1.4.txt">version 3.1.4</a>.
Updated images have been built by <a href="https://osism.tech/">OSISM</a> and are available to be installed.</p>

<p>Set <code class="language-plaintext highlighter-rouge">openvswitch_tag: "2023.1"</code> in the configuration repository in <code class="language-plaintext highlighter-rouge">environments/kolla/configuration.yml</code>.
Afterwards run <code class="language-plaintext highlighter-rouge">osism apply -a upgrade openvswitch</code>.</p>

<p>This will deploy the latest openvswitch images for OSISM 6.0.x series (SCS R5, using OpenStack Antelope), pulling openvswitch 3.1.4.
This only replaces the Open vSwitch image. Open vSwitch only runs on the data and network plane.
Connections may be interrupted when restarting openvswitch-vswitchd. If this is to be avoided workloads should
be live migrated and the update should by done node by node.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial Draft, v0.1, 2024-02-15, 23:45 CET.</li>
  <li>Initial published version, v0.2, 2024-02-20, 12:00 CET.</li>
</ul>]]></content><author><name>[&quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/default-card.jpg" /><media:content medium="image" url="https://scs.community/default-card.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory Cinder Volume detaching (CVE-2023-2088)</title><link href="https://scs.community/security/2023/05/10/cve-2023-2088/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory Cinder Volume detaching (CVE-2023-2088)" /><published>2023-05-10T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2023/05/10/cve-2023-2088</id><content type="html" xml:base="https://scs.community/security/2023/05/10/cve-2023-2088/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>OpenStack allows to attach and detach volumes from running instances.
When a volume is detached from a VM (using the appropriate API call to the
compute service), the compute service (Nova) removes the access to the
volume for the VM and then calls the storage service (Cinder) on the user’s
behalf to force access to be stopped. However, the storage service API
can also be invoked directly by the user. Even if the volume is still
attached, this can be forced and Cinder will not talk to Nova, so it results
in a surprise removal on the compute side. The VM on the compute mode in
this case thus continues to be entitled to access the storage volume,
though this will result in I/O errors due to being rejected by the
storage service.</p>

<p>Due to the way the SCSI and multipath stacks work in Linux, the devices used to
access the storage can be reused. It is thus possible that a newly created
storage volume uses the device that was incompletely revoked before, resulting
in the old VM getting access to the new volume despite not owning it.</p>

<p>In OpenStack setups, this affects storage access via iSCSI and
via FibreChannel.</p>

<p>Authenticated users of the OpenStack IaaS service thus might accidentially
get access to storage volumes that they should not be authorized to.
This can also be provoked by doing lots of force detachments.</p>

<p>The vulnerability has been assigned <a href="https://cve.report/CVE-2023-2088">CVE-2023-2088</a>.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>In the reference implementation of <a href="https://scs.community/">Sovereign Cloud Stack</a>,
the storage service is provided by <a href="https://ceph.io/">ceph</a>
and access to the storage is handled through rados block devices, not the
SCSI layer. No problematic reuse of connections/devices/identifiers has been
found for this and the storage isolation is maintained.</p>

<p>The <a href="https://github.com/osism/cloud-in-a-box">cloud-in-a-box</a> configurations
before ~R4 this year used iSCSI to access local storage volumes – this has
meanwhile been replaced by a single-node ceph setup. So it is not affected any
more. Note that we don’t consider the cloud-in-a-box setup to be meant for
production, so we would not necessarily provide patches with the same urgency
for it even it it was still affected.</p>

<h2 id="scs-provider-status">SCS provider status</h2>

<p>It is possible for providers to diverge from SCS default setup with ceph storage
and connect other block storage backends that use SCSI and are thus affected
by this. We have double-checked with the four productive public clouds (Betacloud,
pluscloud open, Wavestack, regio.digital cloud) that use SCS currently
and they are not affected.</p>

<h2 id="embargo">Embargo</h2>

<p>The issue has been reported by Jan Wasilewski in private to the OpenStack 
Vulnerability Management Team.
The reporters and upstream developers have worked together to address
the issue with fixes and an embargo date
has been set to Wednesday, 2023-05-10, 15:00 UTC. At this point in time, the
patches will get merged and an OpenStack Security Advisory
(<a href="https://security.openstack.org/ossa/OSSA-2023-003.html">OSSA-2023-003</a>) will
be published. The issue is tracked in OpenStack issue
<a href="https://bugs.launchpad.net/nova/+bug/2004555">#2004555</a>, which should be
publically accessible after the advisory has been published.</p>

<p>Under the used responsible disclosure approach, the information was shared with
a select group of trustable users of OpenStack, so they can prepare updates and
protect their user data in time for the publication.</p>

<p>The <a href="https://scs.community/">SCS</a> and <a href="https://osism.tech/">OSISM</a> teams have
analyzed the information carefully and determined that the SCS IaaS reference
implementation from OSISM is not affected in the default configuration.</p>

<h2 id="mitigation-and-fixes">Mitigation and Fixes</h2>

<p>To avoid Cinder removing devices that Nova still assumes to have access to,
Cinder should reject force removals of still-attached volumes unless the
removal request comes from Nova. There are patches from the upstream
maintainers that help Cinder to make that distinction. The OpenStack
os-brick library gets support for a <code class="language-plaintext highlighter-rouge">force</code> parameter that Nova and
Glance can then use. In addition, 
<a href="https://docs.openstack.org/cinder/latest/configuration/block-storage/service-token.html">config changes</a>
need to be applied to enable Nova to send service tokens along with
the user tokens and which is then used by Cinder to validate the
provenance of the request.</p>

<p>The next minor release of OSISM (expected end of May / early June) will include
the necessary changes for the <code class="language-plaintext highlighter-rouge">force</code> parameter. It is still under investigation
whether the changes to enable service tokens can be safely applied as part of
the automated upgrade process or whether that will be documented as an important
hint for cloud operators that diverge in their storage implementation from
the default setup with ceph (where this is all not needed).</p>

<p>A workaround until the next minor release can be implemented by providers.
It would entail a config change that ensures that Nova uses a user with a
service role to send tokens to Cinder on behalf of users and a policy
on the Cinder API that enforces this role. This is described in more detail
in the <a href="https://security.openstack.org/ossa/OSSA-2023-003.html">OpenStack Security Advisory</a>.
We suggest providers that use OSISM in modes which may require such
protection to get in touch with us.</p>

<h2 id="thanks">Thanks</h2>

<p>The authors would like to thank the reporter, the upstream
OpenStack developers and the OpenStack Vulnerability Management Team for the
responsible reporting, careful analysis, fixing, testing and professional
handling of the issue and the OSISM team for additional analysis.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>SCS security contact is <a href="mailto:security@scs.community">security@scs.community</a>, as published on
<a href="https://scs.community/.well-known/security.txt">https://scs.community/.well-known/security.txt</a>.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial Draft, v0.1, 2023-05-10, 10:00 CEST.</li>
  <li>Typos, Security Contact, v0.2, 2023-05-10, 12:30 CEST.</li>
  <li>Add OSSA Link, v1.0, 2023-05-10, 17:00 CEST.</li>
</ul>]]></content><author><name>[&quot;Christian Berendt&quot;, &quot;Kurt Garloff&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/blog/hole-in-fence.jpg" /><media:content medium="image" url="https://scs.community/blog/hole-in-fence.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory OvS proto 0 DoS (CVE-2023-1668)</title><link href="https://scs.community/security/2023/04/21/cve-2023-1668/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory OvS proto 0 DoS (CVE-2023-1668)" /><published>2023-04-21T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2023/04/21/cve-2023-1668</id><content type="html" xml:base="https://scs.community/security/2023/04/21/cve-2023-1668/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>David Marchand (RedHat) reported an issue with Open vSwitch (OvS) where
the failure to properly execute ‘set’ actions for specifically crafted
network packets with IP protocol number 0 could lead to a succesful remote
Denial-of-Service (DoS) attack.</p>

<p>The vulnerability is long-standing and affects Open vSwitch going back until
at least 1.5.0. (Current is 3.1.1, which has this issue fixed.)</p>

<p>The vulnerability has been assigned <a href="https://cve.report/CVE-2023-1668">CVE-2023-1668</a>;
a more detailed description can be found in the 
<a href="https://www.openwall.com/lists/oss-security/2023/04/06/1">Openwall OSS security advisory</a>.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>Open vSwitch is used in almost all OpenStack setups – specifically all SCS
setups known to us use OvS. This includes both the OVN configurations
(the SCS default) as well as those that rely on OvS alone.</p>

<h2 id="mitigation">Mitigation</h2>

<p>It is possible to set flow rules that block IP protocol 0 packets by adding
3 flow rules as highest priority rules to every OvS bridge. Care is needed to
ensure this happens automatically on every single bridge, which is a non-trivial
endeavor.</p>

<p>There are patches available to fix the issue. These patches are included in the
current OvS version 3.1.1. They have also been backported into older versions
3.0.4, 2.17.6, 2.16.7, 2.15.8, 2.14.9, 2.13.11.</p>

<h2 id="scs-releases">SCS releases</h2>

<p>Due to ongoing work on improving the network stack, <a href="https://osism.tech/">OSISM</a>
had released version <a href="http://release.osism.tech/notes/5.1.0.html">5.1.0</a> on Apr 7,
which includes OvS version 3.1.1 that includes the fix. Due to the networking
improvements, the SCS project had advised all SCS partners to move from OSISM-4.x
(SCS Release 3) or from 5.0.0 (SCS Release 4) to 5.1.0 even without being aware
of CVE-2023-1668.</p>

<p>SCS release 3 (OSISM-4.x) is only officially supported until the end of April
2023 – we advise all our partners to move to R4 with OSISM-5.1.0 or later as
soon as possible.</p>

<p>OSISM has worked on preparing a version 4.3.0 that includes a patched OvS version
for those partners that can not yet move to R4/OSISM-5.x. A release of this is
planned for next week. No further updates are planned after this final release
of R3/OSISM-4.x., users should move to R4/OSISM-5.x.</p>

<h2 id="patch-status-of-scs-clouds">Patch status of SCS clouds</h2>

<p>The networking improvements for OSISM-5.1.0 were done in close alignement between
plusserver and OSISM – unsurprisingly, all regions of the 
<a href="https://www.plusserver.com/en/products/pluscloud-open">pluscloud open</a>
had been upgraded to OSISM-5.1.0 in calendar week 15 already.</p>

<p>The <a href="https://betacloud.de/">Betacloud</a> runs the rolling tag (latest) images
and thus has picked up the fixes the day after they became available.</p>

<p>The <a href="https://www.noris.de/wavestack-cloud/">WaveStack</a> operators are planning
to do the upgrade to R4/OSISM-5.1+ next week. For now, their inbound firewalls
protect them from remote attacks with evil proto 0 packets.</p>

<p>The <a href="https://regio.digital/">regio tech</a> cloud has deployed OSISM-5.1.0 last
week already.</p>

<h2 id="thanks">Thanks</h2>

<p>The authors would like to thank David Marchand who reported the vulnerability,
the upstream OvS community and Jens Harbott at OSISM for working on addressing
the issue.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>SCS security contact is <a href="mailto:security@scs.community">security@scs.community</a>, as published on
<a href="https://scs.community/.well-known/security.txt">https://scs.community/.well-known/security.txt</a>.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial Draft, v0.9, 2023-04-21, 08:30 CEST.</li>
  <li>Patch status for beta, wave, regio included, updated OSISM-4.3.0 plans, v1.0, 2023-04-21, 15:45 CEST.</li>
</ul>]]></content><author><name>[&quot;Christian Berendt&quot;, &quot;Kurt Garloff&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/default-card.jpg" /><media:content medium="image" url="https://scs.community/default-card.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Note on bind9 DoS (CVE-2022-3094, -3736, -3924)</title><link href="https://scs.community/security/2023/01/27/bind9-DoS/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Note on bind9 DoS (CVE-2022-3094, -3736, -3924)" /><published>2023-01-27T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2023/01/27/bind9-DoS</id><content type="html" xml:base="https://scs.community/security/2023/01/27/bind9-DoS/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>On 2023-01-25, three vulnerabilities in bind9, a popular DNS server implementation,
were reported. Summarizing the <a href="https://ubuntu.com/security/notices/USN-5827-1">Ubuntu Security Notice</a>:</p>

<ul>
  <li>
    <p><a href="https://ubuntu.com/security/CVE-2022-3094">CVE-2022-3094</a>:
A large number of UPDATE messages can lead to resource exhaustion.
The impact of unauthenticated messages is comparable to normal queries
and thus uncritical; authenticated messages however have a higher
impact.</p>
  </li>
  <li>
    <p><a href="https://ubuntu.com/security/CVE-2022-3736">CVE-2022-3736</a>:
Specially crafted RRSIG queries can cause bind9 to crash.</p>
  </li>
  <li>
    <p><a href="https://ubuntu.com/security/CVE-2022-3924">CVE-2022-3924</a>:
bind9 servers that are configured to respond to queries from stale
cache entries may be caused to crash.</p>
  </li>
</ul>

<p>All three vulnerabilities thus allow remote Denial of Service (DoS)
attacks; the first one though only for trusted parties that can send
authenticated UPDATE messages. No information disclosure or privilege
escalation was found.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>The Designate service (DNS as a Service in OpenStack) is an optional feature of
the <a href="https://scs.community/">Sovereign Cloud Stack</a> IaaS reference
implementation (by <a href="https://osism.tech/">OSISM</a>). Operators can choose to
expose the used bind9 DNS server to the VMs and the internet directly or
use it to feed a dedicated DNS service.</p>

<p>If the bind9 service is exposed, it could be vulnerable to the DoS attacks.</p>

<p>The operators we work closely with are mostly using the stable version (currently
R3, aka v4.x) of the reference implementation, which comes with OpenStack
Yoga and container images built with Ubuntu 20.04 LTS (focal). They
recently had to upgrade to v4.2.0 to address
<a href="https://scs.community/security/2023/01/24/cve-2022-47951/">CVE-2022-47951</a>.</p>

<p>For Ubuntu 20.04, only CVE-2022-3094 applies. Authenticated UPDATE messages
to bind9 can be generated from a user by manipulating the zone records
in Designate via API calls. In our assessement, we deem it unlikely that
it can be done at a rate that results in a successful DoS. The attacker
would obviously also be identifiable.</p>

<p>Operators using the main development branch of OSISM (which includes
container images with OpenStack Zed based on Ubuntu 22.04) are affected
by all three vulnerabilities if they expose bind9 directly. They
thus may experience successful DoS attacks until they address the issue.</p>

<h2 id="fixes-and-recommendations">Fixes and recommendations</h2>

<p>Package updates from Ubuntu have been released.
Users using it to operate their own DNS service obviously should install
the updates.</p>

<p>SCS operators that use v4.2 don’t need to worry as explained before.
A future build of the images will pick up the fixed bind9 version;
currently no plans exist to trigger a minor release just for the
CVE-2022-3094 fix.</p>

<p>SCS operators that use the main branch should ensure that their update
process works to pick up and deploy the regularly rebuilt container
images from OSISM’s main branch. Update: The currently (as of Fri 2023-01-27
afternoon European time) published images with the rolling tag already
contain the fixed bind9.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>SCS security contact is <a href="mailto:security@scs.community">security@scs.community</a>, as published on
<a href="https://scs.community/.well-known/security.txt">https://scs.community/.well-known/security.txt</a>.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Quick security note, v0.5, 2022-01-27, 11:45 CET.</li>
  <li>Minor clarifications, no point release, v1.0, 2022-01-27, 17:00 CET.</li>
  <li>Rolling images already fixed, v1.1, 2022-01-27, 17:15 CET.</li>
</ul>]]></content><author><name>[&quot;Christian Berendt&quot;, &quot;Kurt Garloff&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/default-card.jpg" /><media:content medium="image" url="https://scs.community/default-card.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory VMDK image processing (CVE-2022-47951)</title><link href="https://scs.community/security/2023/01/24/cve-2022-47951/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory VMDK image processing (CVE-2022-47951)" /><published>2023-01-24T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2023/01/24/cve-2022-47951</id><content type="html" xml:base="https://scs.community/security/2023/01/24/cve-2022-47951/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>Guillaume Espanel, Pierre Libeau, Arnaud Morin and Damien Rannou (OVH) found a
vulnerability in the VMDK image processing code in
<a href="https://openstack.org/">OpenStack</a> Cinder (OpenStack’s block storage service),
Glance (image service) and Nova (compute service), which they reported to the
OpenStack security team. The vulnerability allows for crafted flat image files
to reference crafted backing file paths which can result in the
server returning file content with potentially sensitive data. This affects all
Nova and Cinder deployments; it also affects Glance deployments if image
conversion (from VMDK) is enabled.</p>

<p>The vulnerability has been assigned <a href="https://cve.report/CVE-2022-47951">CVE-2022-47951</a>.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>While the <a href="https://scs.community/">Sovereign Cloud Stack</a> reference
implementation (by <a href="https://osism.tech/">OSISM</a>) runs these services in
containers and thus protects most files on the Hypervisor from being accessed
using this vulnerability, the containers do have access to sensitive data and
thus has a potential attacker. <em>To abuse this vulnerability, the attacker must
be an authenticated user of the platform.</em></p>

<p>We are able to reproduce this issue on unpatched platforms using the SCS
reference implementation.
We are still determining whether the damage in our setup goes beyond the
disclosure of sensitive information by potentially leaking credentials that
allow for further privilege escalation up to getting admin access to the IaaS
cloud layer and thus access to all unencrypted data of customers of the
affected platform.</p>

<p>In any case, this vulnerability is very severe and operators of OpenStack
platforms are advised to deploy fixed versions as soon as possible.</p>

<p>While disabling image conversion in Glance does protect Glance, there is no
straight-forward mitigation to effectively protect Cinder and Nova, see
below (Mitigation and Fixes).</p>

<h2 id="embargo">Embargo</h2>

<p>The issue has been reported to the OpenStack Vulnerability Management Team in
private. The reporters and upstream developers have worked together to address
the issue with fixes and an embargo date
has been set to Tuesday, 2023-01-24, 15:00 UTC. At this point in time, the
patches will get merged and the OpenStack Security Advisory
(<a href="https://security.openstack.org/ossa/OSSA-2023-002.html">OSSA-2023-002</a>) will
be published. The issue is tracked in OpenStack issue
<a href="https://bugs.launchpad.net/nova/+bug/1996188">#1996188</a>, which should be
publically accessible now, after the advisory has been published.</p>

<p>Under the used responsible disclosure approach, the information was shared with
a select group of trustable users of OpenStack, so they can prepare updates and
protect their user data in time for the publication.</p>

<p>The reference implementation for the IaaS layer of Sovereign Cloud Stack
is provided by the OSISM project – the OSISM team builds the artifacts in a
completely public process. The fixes will thus be applied right after the 
embargo is lifted; this will result in new artifacts within a few hours;
the resulting artifacts (kolla-ansible container images) will be thoroughly
tested using the CI tests and then published with the tag v4.2.0. This is
expected to happen during the day of Wed, 2023-01-25.
Update: The release of <a href="https://github.com/osism/release/tree/main/4.2.0">OSISM v4.2.0</a>
has happened in the evening (european time) of 2023-01-25.</p>

<p>Given the severity of the issue, the SCS and OSISM teams have agreed to
temporarily build patched images for the Cinder, Nova and Glance services in
private and provide them privately to our public cloud providers with an NDA
that disallows to disclose any information prior to the embargo lift time.</p>

<h2 id="mitigation-and-fixes">Mitigation and Fixes</h2>

<p>The disablement of conversions of VMDK images does protect the Glance service;
unfortunately both Cinder and Nova also support many different image formats
and they don’t provide a config option to disable handling VMDKs. No
simple mitigation is known to us here.</p>

<p>There are patches from the upstream OpenStack developers available. They work
by analyzing the VMDK images and raising an exception if any options are used
that allow extents that reference other files. Such images will no longer be
accepted and thus can no longer be used to exfiltrate sensitive files.</p>

<p>We are able to confirm that the previously successful attacks are addressed
by the fixes. While offending VMDK images can still be uploaded and stored
in Glance, they will be rejected before they can be converted to raw in
Glance or for usage by Cinder or Nova.</p>

<h2 id="patch-status-of-scs-clouds">Patch status of SCS clouds</h2>

<p>We have been working (under NDA) with operators using the SCS reference
implementation from OSISM to ensure they are prepared for this vulnerability.
We can report that the three publically known providers of SCS IaaS
platforms, <a href="https://betacloud.de/">Betacloud</a> (from OSISM),
<a href="https://www.plusserver.com/en/products/pluscloud-open">pluscloud open</a>
(from plusserver) and <a href="https://www.noris.de/wavestack-cloud/">WaveStack</a>
(from Wavecon/Noris) have all deployed the privately provided fixed
containers and are thus protected from the reported vulnerability. They
will all move to the published v4.2.0 release in the next few days to
again use the officially supported public code as opposed to the private
hotfixes.</p>

<h2 id="thanks">Thanks</h2>

<p>The authors would like to thank the abovementioned OVH engineers, the upstream
OpenStack developers and the OpenStack Vulnerability Management Team for the
responsible reporting, careful analysis, fixing, testing and professional
handling of the issue and the OSISM team for providing the fixed containers.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial Draft, v0.1, 2023-01-22, 23:45 CET.</li>
  <li>Links and wording improvements, v0.2, 2023-01-23, 16:00 CET.</li>
  <li>CVS and OSSA links, v0.3, 2023-01-23, 19:00 CET.</li>
  <li>Thanks and reproduction notes, v0.4, 2022-01-24, 08:45 CET.</li>
  <li>Note on rejection point, v0.5, 2022-01-24, 12:15 CET.</li>
  <li>Official release (unchanged), v1.0, 2022-01-24, 16:00 CET.</li>
  <li>v4.2.0 release out, v1.1, 2022-01-27, 08:30 CET.</li>
</ul>]]></content><author><name>[&quot;Christian Berendt&quot;, &quot;Kurt Garloff&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/default-card.jpg" /><media:content medium="image" url="https://scs.community/default-card.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory Spooky SSL</title><link href="https://scs.community/security/2022/11/01/advisory-spookyssl/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory Spooky SSL" /><published>2022-11-01T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2022/11/01/advisory-spookyssl</id><content type="html" xml:base="https://scs.community/security/2022/11/01/advisory-spookyssl/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>On Tue, 2022-11-01, two vulnerabilities in the popular OpenSSL library
became publicly known. They affect OpenSSL-3.0.x versions prior
to the fixed version 3.0.7; older versions of OpenSSL (1.1.x
and earlier) are not affected.</p>

<p>There are two vulnerabilities in the X.509 certificate parsing code
for email addresses, CVE-2022-3602 and CVE-2022-3786. Both are described
in the <a href="https://www.openssl.org/news/secadv/20221101.txt">OpenSSL Security Advisory</a>.
Both can result in buffer overflows which can crash the application,
resulting in a denial-of-service. The possibility to put 4 attacker-controlled
bytes on the stack in CVE-2022-3602 might even result in remote code execution
scenarios, though commonly used stack overflow protections prevent this.
The effectiveness of the stack overflow protections has lead the severity
classification to be downgraded from CRITICAL to HIGH.</p>

<p>A good collection of information on these vulnerabilities can be found on
<a href="https://github.com/NCSC-NL/OpenSSL-2022">Netherlands Cyber Security Centrum</a>.</p>

<h2 id="scs-reference-implementation">SCS reference implementation</h2>

<p>The host images in the SCS reference implementation come from the
<a href="https://osism.tech">OSISM</a> project and are all built on top of Ubuntu 20.04
LTS (focal). Ubuntu 20.04 uses OpenSSL-1.1.1 and is unaffected by the
vulnerability. The switch to Ubuntu 22.04 (jammy) which does use OpenSSL-3.0.x
is planned for SCS R4 (v5.0.0, due in Mar 2023) and has not happened yet,
neither in the OSISM image build system nor in the one from the upstream kolla
project.</p>

<p>The deployment of SCS happens via deploying numerous infrastructure
and OpenStack services in containers. The OpenStack containers come from
the upstream kolla project which uses Ubuntu 20.04. We are in progress
of reviewing all non-kolla containers to ensure that none of them pull-in
dependencies on OpenSSL-3.</p>

<!--TODO: OSISM to check all containers ...-->
<!--TODO: Add link to SBOM -->

<p>The SCS reference implementation for Kubernetes container management deploys a
management host using Ubuntu 20.04 for bootstrapping and managing the
workload clusters. The workload clusters use node images that are built
by OSISM using Ubuntu 20.04. The contained Kubernetes services do not
pull in OpenSSL-3 either.</p>

<p>The container management solution allows to deploy a number of standard
services. Many of the services are built using the golang programming
language and are thus not using OpenSSL.</p>

<p>Here is the list of services that can be deployed with the SCS cluster-API
container management solution and the openSSL status of these:</p>

<table>
  <thead>
    <tr>
      <th>Service</th>
      <th>OpenSSL version</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>OCCM</td>
      <td>1.1.1n</td>
      <td>Alpine 3.15.4</td>
    </tr>
    <tr>
      <td>cindercsi</td>
      <td>none</td>
      <td>golang</td>
    </tr>
    <tr>
      <td>calico</td>
      <td>1.1.1k</td>
      <td>RHEL 8.6</td>
    </tr>
    <tr>
      <td>cilium</td>
      <td>1.1.1f</td>
      <td>Ubuntu 20.04.5</td>
    </tr>
    <tr>
      <td>nginx-ingress</td>
      <td>1.1.1q</td>
      <td>Alpine 3.16</td>
    </tr>
    <tr>
      <td>metrics</td>
      <td>none</td>
      <td>golang</td>
    </tr>
    <tr>
      <td>cert-manager</td>
      <td>none</td>
      <td>golang</td>
    </tr>
    <tr>
      <td>flux</td>
      <td>1.1.1q</td>
      <td>Alpine 3.16.2</td>
    </tr>
  </tbody>
</table>

<!-- TODO: harbor -->

<h2 id="rebuilt-containers">Rebuilt containers</h2>

<p>The SCS community is prepared to publish security updates.
For the containerized OSISM base-deployment, this means preparing updated
containers that can be deployed, replacing the old containers.</p>

<p>Preparing for the OpenSSL-3 vulnerability, the OSISM team has prepared
to publish a version v4.1.0 containing all security and important bug fixes
that have been collected since R3 (v4.0.0 on 2022-09-21).</p>

<p>The OpenSSL-3 vulnerability currently does not seem to require such a
point release. However, there is also a go security update currently
happening, suggesting that a point release may well be good idea.
This is currently under investigation – future updates of this
advisory will contain updated information on this.</p>

<h2 id="public-vm-images-on-scs-clouds">Public VM images on SCS clouds</h2>

<p>Most clouds provide public images for popular Linux distributions
as a convenience to their users. Ubuntu 22.04 is one of the images that
SCS recommends providing; <a href="https://ubuntu.com/security/CVE-2022-3602">it is affected by the OpenSSL-3 issue</a>.
Other modern distributions (e.g. those based on RedHat Enterprise
Linux 9) are also affected; we recommend to use the list at
<a href="https://github.com/NCSC-NL/OpenSSL-2022/blob/main/software/README.md">https://github.com/NCSC-NL/OpenSSL-2022/blob/main/software/README.md</a>
to get a quick overview and to investigate yourself for the more
critical parts of applications. The command <code class="language-plaintext highlighter-rouge">openssl version</code>
can be used to learn about the installed OpenSSL version.</p>

<p>We recommend to SCS operators to quickly replace the affected public images
as soon as the Linux distributors have provided updated base images.
Note that SCS has defined
<a href="https://github.com/SovereignCloudStack/standards/blob/main/Standards/scs-0102-v1-image-metadata.md">metadata</a>
for images that allow users to see the build date. Any image that is older than
2022-11-01 and includes OpenSSL-3.0.x will very likely be vulnerable.</p>

<h2 id="fixing-applications">Fixing applications</h2>

<p>Affected VM-based applications that are dynamically linked against OpenSSL and
use automation for bootstrapping may best just redeploy against the latest
images to use the fixed OpenSSL version. Otherwise an online update of the
OpenSSL-3 library is recommended. Note that applications need to be restarted
to use the updated fixed shared library. Applications that statically linked
the vulnerable OpenSSL-3.0.x (x&lt;7) library need to be rebuilt using the fixed
library (3.0.7 or later).</p>

<p>For container-based applications that built containers using affected
OpenSSL-3 libraries, rebuilding the containers with the fixed version
and redeploying them is recommended.</p>

<p>Sidenote:
We also remind users to review the workstations and laptops that are
used by their staff and to install available updates short-term.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>SCS security contact is <a href="mailto:security@scs.community">security@scs.community</a>, as published on
<a href="https://scs.community/.well-known/security.txt">https://scs.community/.well-known/security.txt</a>.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial release on 2022-11-01, 18:45 CET.</li>
</ul>]]></content><author><name>[&quot;Kurt Garloff&quot;, &quot;Christian Berendt&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/blog/spooky.png" /><media:content medium="image" url="https://scs.community/blog/spooky.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory dirty pipe</title><link href="https://scs.community/security/2022/03/07/advisory-dirty-pipe/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory dirty pipe" /><published>2022-03-07T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2022/03/07/advisory-dirty-pipe</id><content type="html" xml:base="https://scs.community/security/2022/03/07/advisory-dirty-pipe/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>On Fri, 2022-03-07, a failure in the Linux kernel code to properly initialize
the flags field of pipe buffers became widely known as “dirty pipe” 
(<a href="https://seclists.org/oss-sec/2022/q1/170">CVE-2022-0847</a>).
The issue had been discovered and responsibly disclosed by Max Kellermann
from IONOS SE.
The bug allows any local user on a system to overwrite data in any file
regardless of permissions and thus creates a trivial local root exploit.
Even the page cache of read-only mappings can be overwritten (not leaving
any traces on persistent storage).</p>

<p>The issue was exposed (not introduced) by kernel commit 
<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f6dd975583bd8ce088400648fd9819e4691c8958">f6dd975583bd</a>
and affects Linux kernels 5.8 and newer. It was fixed with commit
<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9d2231c5d74e13b2a0546fee6737ee4446017903">9d2231c5d74e</a>
and is also addressed in the stable kernels 5.16.11, 
5.15.25 and 5.10.102.</p>

<p>More details can be found on <a href="https://dirtypipe.cm4all.com/">https://dirtypipe.cm4all.com/</a>.</p>

<h2 id="scs-reference-implementation">SCS reference implementation</h2>

<p>The host images in the SCS reference implementation come from the 
<a href="https://osism.tech">OSISM</a> project and are all built on top of 
Ubuntu 20.04 LTS. To the best of our knowledge, the 5.4.xxx kernels
used there are NOT affected by the issue. The exploit code fails to
alter the page cache there. We are waiting
to get an <a href="https://ubuntu.com/security/CVE-2022-0847">official announcement</a>
from Canonical for a final confirmation.</p>

<p>The management host deployed by the automation for our cluster management is
using an Ubuntu 20.04 LTS image by default – it is thus not affected.
We use cluster-api images for the kubernetes clusters provided by
<a href="https://minio.services.osism.tech/openstack-k8s-capi-images">OSISM</a>. These
are built on top of Ubuntu 20.04 LTS and thus not affected either.</p>

<p>Cloud operators often provide popular Linux images as a convenience
for their customers. These are not provided by SCS.
Some of these Linux images are affected, e.g. newer non-LTS versions of Ubuntu,
Fedora or Arch Linux. These should be updated to support the customers
in protecting their VMs.</p>

<h2 id="mitigation-and-fix">Mitigation and fix</h2>

<p>At this time, for cloud providers using the SCS reference implementation,
we see no required actions to protect the infrastructure, as the SCS reference
implementation does not use any images that use the affected kernels.</p>

<p>We recommend SCS operators to double check that no supporting system uses
a vulnerable kernel. Furthermore, operators may have chosen newer kernels
(e.g. the hardware enablement series from Ubuntu) due to specific hardware
requirements. In both cases, we recommend a short-term risk assessment and
the scheduling of the installation of fixed kernels.</p>

<p>Most cloud operators provide images for the most popular Linux operating
systems. We strongly recommend to replace them with updated images as soon
as the Linux distributors have provided updated base images (which is
the case for many distributors at this point).
Note that SCS has defined <a href="https://github.com/SovereignCloudStack/standards/blob/main/Standards/scs-0102-v1-image-metadata.md">metadata</a>
for images that allow users to see the build date. Any image that’s older than
2022-02-21 and has a Linux kernel version &gt;= 5.8 will very likely
be vulnerable.</p>

<h2 id="note">Note</h2>

<p>We are in fact lucky that the Sovereign Cloud Stack reference implementation
is not affected by this high-risk vulnerability. Avoiding too many different
Linux distributions and choosing a version with good long-term support were
deliberate choices, but of course these are no guarantee to not be affected.
They intended to ensure we can react quickly and effectively if affected.</p>

<p>Images are built and tested nightly in the OSISM infrastructure; we would have
pushed out new images within a day if we had been affected, so we have prepared
to react to issues like this. We will however use the opportunity to double-check
that our reactions would have worked.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>SCS security contact is <a href="mailto:security@scs.community">security@scs.community</a>, as published on
<a href="https://scs.community/.well-known/security.txt">https://scs.community/.well-known/security.txt</a>.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial release on 2022-03-07, 23:00 CET.</li>
</ul>]]></content><author><name>[&quot;Christian Berendt&quot;, &quot;Kurt Garloff&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/blog/pipe.jpg" /><media:content medium="image" url="https://scs.community/blog/pipe.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Sovereign Cloud Stack Security Advisory log4j</title><link href="https://scs.community/security/2021/12/13/advisory-log4j/" rel="alternate" type="text/html" title="Sovereign Cloud Stack Security Advisory log4j" /><published>2021-12-13T00:00:00+00:00</published><updated>2024-03-21T11:48:02+00:00</updated><id>https://scs.community/security/2021/12/13/advisory-log4j</id><content type="html" xml:base="https://scs.community/security/2021/12/13/advisory-log4j/"><![CDATA[<h2 id="the-vulnerability">The vulnerability</h2>

<p>On Fri, 2021-12-10, a design issue in the very popular Java library log4j
was reported and assigned <a href="https://www.lunasec.io/docs/blog/log4j-zero-day/">CVE-2021-44228</a>
with a CVSS score of 10, which is the highest
possible score and thus means that this is a very critical vulnerability.
In short, log4j interprets strings that are being submitted to it
causing lookups via the JNDI interface (intended e.g. to do LDAP name resolution).
If attackers can cause log4j to log attacker controlled strings, these can be used
to trigger these lookups and cause arbitrary java code to be loaded and
executed. This can be used to gain access to the
application that uses log4j and the container/VM that the application
is running in. As log4j is so popular, many Java applications are
affected. At this point in time, all log4j versions prior to
log4j2-2.15(-rc2) are affected.</p>

<p>Our German readers might want to read the excellent summary in the
<a href="https://www.bsi.bund.de/SharedDocs/Cybersicherheitswarnungen/DE/2021/2021-549032-10F2.pdf?__blob=publicationFile&amp;v=3">BSI advisory</a>.</p>

<h2 id="usage-of-log4j-in-scs">Usage of log4j in SCS</h2>

<p>The main components of Sovereign Cloud Stack do not use Java.
However, there are Java tools used at a few places:</p>

<ol>
  <li>Keycloak (Identity broker)</li>
  <li>Nexus (Mirror manager)</li>
  <li>Elasticsearch (Log analysis tool)</li>
</ol>

<p>Neither <a href="https://github.com/keycloak/keycloak/discussions/9078">keycloak</a>
nor nexus are affected by the log4j vulnerability.</p>

<p>However, Elasticsearch does use log4j. Elasticsearch is rolled out in a
container on the SCS compute nodes by default in SCS deployments to allow for
log analysis.</p>

<h2 id="potential-impact">Potential impact</h2>

<p>Normal users do not interact with the Elasticsearch functionality in SCS;
only operators have access to it. An issue that can be abused by operators
is not a serious threat to SCS environments, as in all practical setups,
the operators have more privileges to affect the environment than they
could gain by exploiting vulnerabilities in Elasticsearch. This might only
be different in environments with very large operational teams and a very
fine-grained operational access role model.</p>

<p>However, we can at this point not exclude the possibility that a name
controlled by the user (such as the name from a resource at OpenStack
or Kubernetes level) gets logged and later on processed by ElasticSearch
and logged again via log4j. If so, a user could cause undesired actions
within the ElasticSearch container. If a potential
attacker could in addition find another exploit to escape the container
confinement, he could take over the SCS deployment.</p>

<h2 id="mitigation-and-fix">Mitigation and fix</h2>

<p>Until a new version of the Elasticsearch container that uses a fixed
log4j is available, we recommend applying the following change:</p>

<ol>
  <li>
    <p>Change the configuration repository.
In <code class="language-plaintext highlighter-rouge">environments/kolla/configuration.yml</code>, add <code class="language-plaintext highlighter-rouge">-Dlog4j2.formatMsgNoLookups=true</code> to the JVM
startup paramters:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   es_java_opts: "-Dlog4j2.formatMsgNoLookups=true {% if es_heap_size %}-Xms{{ es_heap_size }} -Xmx{{ es_heap_size }}{%endif%}"

</code></pre></div>    </div>
  </li>
  <li>Roll out the changes:
    <ul>
      <li>If you are <em>not</em> using Celery:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  osism-manager configuration
</code></pre></div>        </div>
      </li>
      <li>If you are using Celery:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  osism apply configuration
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>(Re)deploy Elasticsearch:
    <ul>
      <li>If you are <em>not</em> using Celery:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  osism-kolla deploy elastisearch
</code></pre></div>        </div>
      </li>
      <li>If you are using Celery:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  osism apply elasticsearch
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<p>This causes log4j to no longer interpret the input in ways that lookups
can be triggered and thus reliably avoids the vulnerability. Please note that
this setting <code class="language-plaintext highlighter-rouge">log4j2.formatMsgNoLookups</code> is only available in
log4j2 &gt;= 2.10.0, which is fortunately the case in the Elasticsearch container.</p>

<p>When a new Elasticsearch container built with the fixed log4j (2.16 or better 2.17+)
becomes available, we’ll issue a new advisory that describes the deployment of the
new container.</p>

<h2 id="update-2021-12-21-fix-still-valid">Update 2021-12-21: Fix still valid</h2>

<p>Meanwhile, two more security issues around log4j have been reported:
<a href="https://www.whitesourcesoftware.com/resources/blog/log4j-vulnerability-cve-2021-45046/">CVE-2021-45046</a>
and <a href="https://www.whitesourcesoftware.com/resources/blog/log4j-vulnerability-cve-2021-45105/">CVE-2021-45105</a>.
The former is a context lookup vulnerability (as a variation to the JNDI
lookup vulnerability) while the latter is a Denial of Service attack by
causing an infinite recursion on the context lookup.</p>

<p>The recommended setting <code class="language-plaintext highlighter-rouge">log4j2.formatMsgNoLookups=true</code>
is still fully mitigating the issues in our environment.</p>

<p>The <code class="language-plaintext highlighter-rouge">es_java_opts</code> setting has been configured in the upstream
<a href="https://github.com/osism/ansible-defaults">OSISM/ansible_defaults</a>
repository meanwhile (commit c84f87a6106dd53d08447ac7d5a24b2677da38f0),
so fresh deployments of SCS testbeds or production environments get
the mitigation automatically. You can validate this by logging in to
one of your compute nodes and checking the jvm parameters in the process
list (elastic search container). You should find <code class="language-plaintext highlighter-rouge">-Dlog4j2.formatMsgNoLookups=true</code>
in the parameter list.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>Please contact the SCS project management team at
<a href="mailto:project@scs.sovereignit.de">project at scs dot sovereignit dot de </a>
to ask security questions or report security issues.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Minor update on 2021-12-21, 17:45 CET:
    <ul>
      <li>Information on new CVEs and workaround still being effective.</li>
      <li>Update recommended log4j version to 2.17+.</li>
      <li>Mention the implementation and validation in testbed.</li>
    </ul>
  </li>
  <li>Minor update on 2021-12-14, 15:45 CET:
    <ul>
      <li>Remove wrong space in <code class="language-plaintext highlighter-rouge">osism apply elasticsearch</code></li>
      <li>Elsasticsearch is deployed on the compute hosts in typical setups, not the manager node.</li>
      <li>Mention that lookups are done via JNDI to better connect to other descriptions.</li>
      <li>Mention that the java parameter is only available on log4j2 &gt;= 2.10, which covers the SCS Elasticsearch.</li>
      <li>Mention fixed version be better 2.16+.</li>
    </ul>
  </li>
  <li>Initial release on 2021-12-13, 18:30 CET.</li>
</ul>]]></content><author><name>[&quot;Christian Berendt&quot;, &quot;Kurt Garloff&quot;, &quot;Felix Kronlage-Dammers&quot;]</name></author><category term="security" /><summary type="html"><![CDATA[The vulnerability]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://scs.community/default-card.jpg" /><media:content medium="image" url="https://scs.community/default-card.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>